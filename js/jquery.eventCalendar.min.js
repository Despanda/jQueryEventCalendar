/* =
    jquery.eventCalendar.js
    version: 0.67
    date: 14-03-2015
    author:
        Jaime Fernandez (@vissit)
    company:
        Paradigma Tecnologico (@paradigmate)
*/

;!function(e){e.fn.eventCalendar=function(t){function a(e,t){return"string"==typeof e.date?e.date.toLowerCase()>t.date.toLowerCase()?1:-1:e.date>t.date?1:-1}function n(t){var a=e("<div class='eventsCalendar-slider'></div>"),n=e("<div class='eventsCalendar-monthWrap'></div>"),r=e("<div class='eventsCalendar-currentTitle'><a href='#' class='eventsCalendar-monthTitle'></a></div>"),d=e("<a href='#' class='eventsCalendar-arrow eventsCalendar-prev'><span>"+v.txt_prev+"</span></a><a href='#' class='eventsCalendar-arrow eventsCalendar-next'><span>"+v.txt_next+"</span></a>");if($eventsCalendarDaysList=e("<ul class='eventsCalendar-daysList'></ul>"),date=new Date,p.wrap.find(".eventsCalendar-slider").size()?p.wrap.find(".eventsCalendar-slider").append(n):(p.wrap.prepend(a),a.append(n)),p.wrap.find(".eventsCalendar-monthWrap.eventsCalendar-currentMonth").removeClass("eventsCalendar-currentMonth").addClass("eventsCalendar-oldMonth"),n.addClass("eventsCalendar-currentMonth").append(r,$eventsCalendarDaysList),"current"===t)day=date.getDate(),a.append(d);else{date=new Date(p.wrap.attr("data-current-year"),p.wrap.attr("data-current-month"),1,0,0,0),day=0,moveOfMonth=1,"prev"===t&&(moveOfMonth=-1),date.setMonth(date.getMonth()+moveOfMonth);var i=new Date;date.getMonth()===i.getMonth()&&(day=i.getDate())}var l=date.getFullYear(),o=(new Date).getFullYear(),c=date.getMonth();"current"!=t&&s(v.eventsLimit,l,c,!1,t),p.wrap.attr("data-current-month",c).attr("data-current-year",l),r.find(".eventsCalendar-monthTitle").html(v.monthNames[c]+" "+l);var h,f=32-new Date(l,c,32).getDate(),u=[];if(v.showDayAsWeeks){if($eventsCalendarDaysList.addClass("eventsCalendar-showAsWeek"),v.showDayNameInCalendar)for($eventsCalendarDaysList.addClass("eventsCalendar-showDayNames"),h=0,v.startWeekOnMonday&&(h=1);7>h;h++)u.push('<li class="eventsCalendar-day-header">'+v.dayNamesShort[h]+"</li>"),6===h&&v.startWeekOnMonday&&u.push('<li class="eventsCalendar-day-header">'+v.dayNamesShort[0]+"</li>");dt=new Date(l,c,1);var C=dt.getDay();for(v.startWeekOnMonday&&(C=dt.getDay()-1),0>C&&(C=6),h=C;h>0;h--)u.push('<li class="eventsCalendar-day eventsCalendar-empty"></li>')}for(dayCount=1;f>=dayCount;dayCount++){var m="";day>0&&dayCount===day&&l===o&&(m="today"),u.push('<li id="dayList_'+dayCount+'" rel="'+dayCount+'" class="eventsCalendar-day '+m+'"><a href="#">'+dayCount+"</a></li>")}$eventsCalendarDaysList.append(u.join("")),a.css("height",n.height()+"px")}function r(e){var t,a=e.length,n=e.charAt(a-1);return t=2===a&&"1"===e.charAt(0)?v.txt_NumAbbrevTh:"1"===n?v.txt_NumAbbrevSt:"2"===n?v.txt_NumAbbrevNd:"3"===n?v.txt_NumAbbrevRd:v.txt_NumAbbrevTh,e+t}function s(t,a,n,r,s){t=t||0,a=a||"",r=r||"",n="undefined"!=typeof n?n:"",p.wrap.find(".eventsCalendar-loading").fadeIn(),v.jsonData?(v.cacheJson=!0,p.eventsJson=v.jsonData,d(p.eventsJson,t,a,n,r,s)):v.cacheJson&&s?d(p.eventsJson,t,a,n,r,s):e.getJSON(v.eventsjson+"?limit="+t+"&year="+a+"&month="+n+"&day="+r,function(e){p.eventsJson=e,d(p.eventsJson,t,a,n,r,s)}).error(function(){l("error getting json: ")}),r>""&&(p.wrap.find(".eventsCalendar-current").removeClass("eventsCalendar-current"),p.wrap.find("#dayList_"+r).addClass("eventsCalendar-current"))}function d(t,n,s,d,i,l){directionLeftMove="-="+p.directionLeftMove,eventContentHeight="auto",subtitle=p.wrap.find(".eventsCalendar-list-wrap .eventsCalendar-subtitle"),l?(subtitle.html(""!==i?v.txt_SpecificEvents_prev+v.monthNames[d]+" "+r(i)+" "+v.txt_SpecificEvents_after:v.txt_SpecificEvents_prev+v.monthNames[d]+" "+v.txt_SpecificEvents_after),"eventsCalendar-prev"===l?directionLeftMove="+="+p.directionLeftMove:("day"===l||"month"===l)&&(directionLeftMove="+=0",eventContentHeight=0)):(subtitle.html(v.txt_NextEvents),eventContentHeight="auto",directionLeftMove="-=0"),p.wrap.find(".eventsCalendar-list").animate({opacity:v.moveOpacity,left:directionLeftMove,height:eventContentHeight},v.moveSpeed,function(){p.wrap.find(".eventsCalendar-list").css({left:0,height:"auto"}).hide();var r=[];if(t=e(t).sort(a),t.length){var l="";v.showDescription||(l="eventsCalendar-hidden");var o="_self";v.openEventInNewWindow&&(o="_target");var c=0;e.each(t,function(e,t){if("human"==v.jsonDateFormat)var a=t.date.split(" "),h=a[0].split("-"),f=a[1].split(":"),u=h[0],C=parseInt(h[1])-1,m=parseInt(h[2]),w=(parseInt(C)+1,f[0]),y=f[1],g=f[2],h=new Date(u,C,m,w,y,g);else var h=new Date(parseInt(t.date)),u=h.getFullYear(),C=h.getMonth(),m=h.getDate(),w=h.getHours(),y=h.getMinutes();if(parseInt(y)<=9&&(y="0"+parseInt(y)),(0===n||n>c)&&!(d!==!1&&d!==C||""!==i&&i!==m||""!==s&&s!==u))if(d===!1&&h<new Date);else{eventStringDate=moment(h).format(v.dateFormat);var D;if(t.url)var D='<a href="'+t.url+'" target="'+o+'" class="eventsCalendar-eventTitle">'+t.title+"</a>";else var D='<span class="eventsCalendar-eventTitle">'+t.title+"</span>";r.push('<li id="'+e+'" class="'+t.type+'"><time datetime="'+h+'"><em>'+eventStringDate+"</em><small>"+w+":"+y+"</small></time>"+D+'<p class="eventsCalendar-eventDesc '+l+'">'+t.description+"</p></li>"),c++}u==p.wrap.attr("data-current-year")&&C==p.wrap.attr("data-current-month")&&p.wrap.find(".eventsCalendar-currentMonth .eventsCalendar-daysList #dayList_"+parseInt(m)).addClass("eventsCalendar-dayWithEvents")})}r.length||r.push('<li class="eventsCalendar-noEvents"><p>'+v.txt_noEvents+"</p></li>"),p.wrap.find(".eventsCalendar-loading").hide(),p.wrap.find(".eventsCalendar-list").html(r.join("")),p.wrap.find(".eventsCalendar-list").animate({opacity:1,height:"toggle"},v.moveSpeed)}),o()}function i(){p.wrap.find(".eventsCalendar-arrow").click(function(t){if(t.preventDefault(),e(this).hasClass("eventsCalendar-next")){n("next");var a="-="+p.directionLeftMove}else{n("prev");var a="+="+p.directionLeftMove}p.wrap.find(".eventsCalendar-monthWrap.eventsCalendar-oldMonth").animate({opacity:v.moveOpacity,left:a},v.moveSpeed,function(){p.wrap.find(".eventsCalendar-monthWrap.eventsCalendar-oldMonth").remove()})})}function l(e){p.wrap.find(".eventsCalendar-list-wrap").html("<span class='eventsCalendar-loading eventsCalendar-error'>"+e+" "+v.eventsjson+"</span>")}function o(){p.directionLeftMove=p.wrap.width(),p.wrap.find(".eventsCalendar-monthWrap").width(p.wrap.width()+"px"),p.wrap.find(".eventsCalendar-list-wrap").width(p.wrap.width()+"px")}var v=e.extend({},e.fn.eventCalendar.defaults,t),p={wrap:"",directionLeftMove:"300",eventsJson:{}};this.each(function(){p.wrap=e(this),p.wrap.addClass("eventCalendar-wrap").append("<div class='eventsCalendar-list-wrap'><p class='eventsCalendar-subtitle'></p><span class='eventsCalendar-loading'>"+v.txt_loading+"</span><div class='eventsCalendar-list-content'><ul class='eventsCalendar-list'></ul></div></div>"),v.eventsScrollable&&p.wrap.find(".eventsCalendar-list-content").addClass("scrollable"),o(),e(window).resize(function(){o()}),n("current"),s(v.eventsLimit,!1,!1,!1,!1),i(),p.wrap.on("click",".eventsCalendar-day a",function(t){t.preventDefault();var a=p.wrap.attr("data-current-year"),n=p.wrap.attr("data-current-month"),r=e(this).parent().attr("rel");s(!1,a,n,r,"day")}),p.wrap.on("click",".eventsCalendar-monthTitle",function(e){e.preventDefault();var t=p.wrap.attr("data-current-year"),a=p.wrap.attr("data-current-month");s(v.eventsLimit,t,a,!1,"month")})}),p.wrap.find(".eventsCalendar-list").on("click",".eventsCalendar-eventTitle",function(t){if(!v.showDescription){t.preventDefault();var a=e(this).parent().find(".eventsCalendar-eventDesc");if(!a.find("a").size()){var n=e(this).attr("href"),r=e(this).attr("target");a.append('<a href="'+n+'" target="'+r+'" class="bt">'+v.txt_GoToEventUrl+"</a>")}a.is(":visible")?a.slideUp():(v.onlyOneDescription&&p.wrap.find(".eventsCalendar-eventDesc").slideUp(),a.slideDown())}})},e.fn.eventCalendar.defaults={eventsjson:"js/events.json",eventsLimit:4,monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],txt_noEvents:"There are no events in this period",txt_SpecificEvents_prev:"",txt_SpecificEvents_after:"events:",txt_next:"next",txt_prev:"prev",txt_NextEvents:"Next events:",txt_GoToEventUrl:"See the event",txt_NumAbbrevTh:"th",txt_NumAbbrevSt:"st",txt_NumAbbrevNd:"nd",txt_NumAbbrevRd:"rd",txt_loading:"loading...",showDayAsWeeks:!0,startWeekOnMonday:!0,showDayNameInCalendar:!0,showDescription:!1,onlyOneDescription:!0,openEventInNewWindow:!1,eventsScrollable:!1,dateFormat:"D/MM/YYYY",jsonDateFormat:"timestamp",moveSpeed:500,moveOpacity:.15,jsonData:"",cacheJson:!0}}(jQuery);